{% extends 'base.html' %}

{% block title %}Checkout - Order #{{ order.id }}{% endblock %}

{% block content %}
<div class="container-lg">
    <h1>Checkout</h1>
    <p><strong>Restaurant:</strong> {{ order.restaurant_name }}</p>
</div>

<div class="container-lg">
    <h2>Order Summary</h2>
    <table class="table mt-3">
        <thead>
            <tr>
                <th>Item</th>
                <th>Quantity</th>
                <th>Unit Price</th>
                <th>Subtotal</th>
            </tr>
        </thead>
        <tbody>
            {% for item in items %}
            <tr>
                <td>{{ item.item_name }}</td>
                <td>{{ item.quantity }}</td>
                <td>
                    {% if order.country == 'India' %}
                        ₹{{ "%.2f"|format(item.unit_price) }}
                    {% else %}
                        ${{ "%.2f"|format(item.unit_price) }}
                    {% endif %}
                </td>
                <td>
                    {% if order.country == 'India' %}
                        ₹{{ "%.2f"|format(item.subtotal) }}
                    {% else %}
                        ${{ "%.2f"|format(item.subtotal) }}
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
            <tr class="table">
                <td colspan="3" class="text-end">Total:</td>
                <td>
                    {% if order.country == 'India' %}
                        ₹{{ "%.2f"|format(order.total_amount) }}
                    {% else %}
                        ${{ "%.2f"|format(order.total_amount) }}
                    {% endif %}
                </td>
            </tr>
        </tbody>
    </table>
</div>

<div class="container-lg">
    <h2>Payment Information</h2>
    <form method="post">
        <div class="form-group">
            <label for="payment_method_id" class="form-label">Select Payment Method</label>
            <select class="form-select" id="payment_method_id" name="payment_method_id" required>
                <option value="">Choose payment method...</option>
                {% for method in payment_methods %}
                    <option value="{{ method.id }}">{{ method.name }} - {{ method.description }}</option>
                {% endfor %}
            </select>
        </div>
        
        <div style="margin-top: 1.5rem;">
            <button type="submit" class="btn btn-success" {% if g.user.role not in ['ADMIN', 'MANAGER'] %}disabled{% endif %}>Place Order</button>
            <a href="{{ url_for('order.edit_order', order_id=order.id) }}" class="btn btn-secondary">Back to Cart</a>
        </div>
    </form>
</div>

<div class="alert alert-info mt-3">
    <strong>Note:</strong> Only ADMIN and MANAGER roles can place orders. 
    {% if g.user.role == 'MEMBER' %}
        As a MEMBER, you cannot complete checkout.
    {% endif %}
</div>
{% endblock %}

